<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Whack A Mole!</title>
  <link href='https://fonts.googleapis.com/css?family=Amatic+SC:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://fav.farm/ðŸ”¥" />
</head>
<body>

  <h1>Whack-a-mole! <span class="score">0</span></h1>
  <button class="start" onClick="startGame()">Start!</button>
  <button class="stop" onclick="stopGame()" disabled>Stop!</button>
  <button class="clear" onclick="clearGame()">Clear</button>
  <span class="display_time"></span>
  <span class="high_score">New High Score:0</span>


  <div class="game">
    <div class="hole hole1">
      <div class="mole"></div>
    </div>    
    <div class="hole hole2">
      <div class="mole"></div>
    </div>
    <div class="hole hole3">
      <div class="mole"></div>
    </div>
    <div class="hole hole4">
      <div class="mole"></div>
    </div>
    <div class="hole hole5">
      <div class="mole"></div>
    </div>
    <div class="hole hole6">
      <div class="mole"></div>
    </div>
  </div>


<script>
  const holes = document.querySelectorAll('.hole');
  const scoreBoard = document.querySelector('.score');
  const moles = document.querySelectorAll('.mole');
  const start = document.querySelector('.start'); 
  const stop = document.querySelector('.stop');
  const clear=document.querySelector('.clear');
  const timerDisplay=document.querySelector('.display_time');
  const highestscore=document.querySelector('.high_score')
  let lastHole;
  let currScore=0;
  let timeUp=false;
  let score=0;
  let timer=10;
  let gameTimer;
  let startTime;
  let remainingTime=10;

  const highscore=JSON.parse(localStorage.getItem('highscore'))||0;
  highestscore.textContent=`New High Score:${highscore}`;


  function randomTime(min,max){
    return Math.round(Math.random()*(max-min)+min);
  }

  function randomHole(holes){
    const idx=Math.floor(Math.random()*holes.length);
    const hole=holes[idx];
    if(hole===lastHole){
      // console.log('same one');
      return randomHole(holes);
    }
    // console.log(hole)
    lastHole=hole;
    return hole;
  }

  function peep(){
    const time=randomTime(200,1000);
    const hole=randomHole(holes);
    // console.log(time,hole)
    hole.classList.add('up');
    setTimeout(() =>{
      hole.classList.remove('up');
      if(!timeUp) peep();
    },time)
  }

  function startGame(){
    if(!timeUp && gameTimer) return;
    timeUp=false;
    // score=0;
    if (remainingTime <= 0 || remainingTime === 10){ 
      score = 0; 
      scoreBoard.textContent = score; 
      remainingTime = 10;  
    }
    timer=remainingTime>0?remainingTime:10;
    scoreBoard.textContent=score;
    timerDisplay.textContent=timer
    start.disabled = true;
    stop.disabled = false;
    peep();
    gameTimer=setInterval(() => {
      timer--;
      remainingTime=timer;
      timerDisplay.textContent=timer;
      if(timer<=0){
        clearInterval(gameTimer);
        timeUp=true;
        start.disabled = false;
        stop.disabled = true;
        scoreBoard.textContent = 0;
        let highscore=JSON.parse(localStorage.getItem('highscore'))||0;
        highestscore.textContent=`New High Score:${highscore}`;
      }
      // timeUp=true;
      // start.disabled = false;
      // stop.disabled = true;
    },1000);
  }

  function stopGame(){
    clearInterval(gameTimer); 
    timeUp = true;     
    // if(timer>0){
    //   return
    // }       
    start.disabled = false;
    stop.disabled = true;
    // return timer,score;  
    // if (remainingTime < 0){
    //   remainingTime = 0;
    // }
    // console.log('stop')
  }


  function clearGame(){ 
    clearTimeout(gameTimer); 
    timeUp = true;  
    score = 0;  
    timer=10
    scoreBoard.textContent = 0;
    timerDisplay.textContent=10 
    remainingTime = 10;  
    start.disabled = false;  
    stop.disabled = true;  
  }

 
  function bonk(e){
    // console.log(e)
    if(!e.isTrusted) return;
    score++;
    this.classList.remove('up')
    scoreBoard.textContent=score;
    let highscore=JSON.parse(localStorage.getItem('highscore'))||0;
    if(score>highscore){
      localStorage.setItem('highscore',JSON.stringify(score));
      highestscore.textContent=`New High Score:${score}`;
    }
  }


  
  // localStorage.setItem('highscore',JSON.stringify(score));

  // const highscore=localStorage.getItem('highscore')
  // console.log(highscore);
  

  // function highScore(){
  //   localStorage.setItem('highscore',score)
  // }

  // function gethighScore(){
  //   const highscore=localStorage.getItem('highscore')
  //   // console.log(highscore);
  //   highestscore.textContent=`New High Score:${highscore}`;
  // }
 
  moles.forEach(mole =>mole.addEventListener('click',bonk))


  // need to show timer in ui
  // when timer is started the start button should be disabled
  // need to give one stop/end button to clear the game in between.
  // display highscore .. also give button to clear the highscore
  // Bonus task : give options : game level : easy , medium , hard (handle transition time according to the level selected , by default it will be set on easy)

</script>
</body>
</html>
